<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">

<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1"/>
  <meta name="generator" content="distill" />

  <style type="text/css">
  /* Hide doc at startup (prevent jankiness while JS renders/transforms) */
  body {
    visibility: hidden;
  }
  </style>

 <!--radix_placeholder_import_source-->
 <!--/radix_placeholder_import_source-->

  <!--radix_placeholder_meta_tags-->
<title>Edward Hillenaar: Analyze and visualize your iPhone's Health app data in R</title>

<meta property="description" itemprop="description" content="Learn to import, analyze and visualize your Health app data in R"/>

<link rel="canonical" href="https://taraskaduk.com/posts/2019-03-23-apple-health/"/>
<link rel="icon" type="image/png" href="../../static/logo.png"/>

<!--  https://schema.org/Article -->
<meta property="article:published" itemprop="datePublished" content="2019-03-23"/>
<meta property="article:created" itemprop="dateCreated" content="2019-03-23"/>
<meta name="article:author" content="Taras Kaduk"/>

<!--  https://developers.facebook.com/docs/sharing/webmasters#markup -->
<meta property="og:title" content="Edward Hillenaar: Analyze and visualize your iPhone&#39;s Health app data in R"/>
<meta property="og:type" content="article"/>
<meta property="og:description" content="Learn to import, analyze and visualize your Health app data in R"/>
<meta property="og:url" content="https://taraskaduk.com/posts/2019-03-23-apple-health/"/>
<meta property="og:locale" content="en_US"/>
<meta property="og:site_name" content="Edward Hillenaar"/>

<!--  https://dev.twitter.com/cards/types/summary -->
<meta property="twitter:card" content="summary"/>
<meta property="twitter:title" content="Edward Hillenaar: Analyze and visualize your iPhone&#39;s Health app data in R"/>
<meta property="twitter:description" content="Learn to import, analyze and visualize your Health app data in R"/>
<meta property="twitter:url" content="https://taraskaduk.com/posts/2019-03-23-apple-health/"/>
<meta property="twitter:site" content="@taraskaduk"/>

<!--  https://scholar.google.com/intl/en/scholar/inclusion.html#indexing -->
<meta name="citation_title" content="Edward Hillenaar: Analyze and visualize your iPhone&#39;s Health app data in R"/>
<meta name="citation_fulltext_html_url" content="https://taraskaduk.com/posts/2019-03-23-apple-health/"/>
<meta name="citation_online_date" content="2019/03/23"/>
<meta name="citation_publication_date" content="2019/03/23"/>
<meta name="citation_author" content="Taras Kaduk"/>
<!--/radix_placeholder_meta_tags-->
  <!--radix_placeholder_rmarkdown_metadata-->

<script type="text/json" id="radix-rmarkdown-metadata">
{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["title","date","description","author","output","citation_url","canonical_url"]}},"value":[{"type":"character","attributes":{},"value":["Analyze and visualize your iPhone's Health app data in R"]},{"type":"character","attributes":{},"value":["2019-03-23"]},{"type":"character","attributes":{},"value":["Learn to import, analyze and visualize your Health app data in R"]},{"type":"list","attributes":{},"value":[{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","url"]}},"value":[{"type":"character","attributes":{},"value":["Taras Kaduk"]},{"type":"character","attributes":{},"value":["https://taraskaduk.com"]}]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["distill::distill_article"]}},"value":[{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["self_contained"]}},"value":[{"type":"logical","attributes":{},"value":[false]}]}]},{"type":"character","attributes":{},"value":["https://taraskaduk.com/posts/2019-03-23-apple-health/"]},{"type":"character","attributes":{},"value":["https://taraskaduk.com/posts/2019-03-23-apple-health/"]}]}
</script>
<!--/radix_placeholder_rmarkdown_metadata-->
  
  <script type="text/json" id="radix-resource-manifest">
  {"type":"character","attributes":{},"value":["1.jpg","apple-health_files/bowser-1.9.3/bowser.min.js","apple-health_files/distill-2.2.21/template.v2.js","apple-health_files/jquery-1.11.3/jquery.min.js","apple-health_files/webcomponents-2.0.0/webcomponents.js","applewatch1.png","applewatch2.png","bp.png","chain.png","cheese.gif","cheese.jpeg","cover.png","daily.png","dietary.png","energy1.png","energy2.png","header.png","header2.png","heatmap1.png","hourly.png","streak.png","weight.gif","weight1.png","weight2.png"]}
  </script>
  <!--radix_placeholder_navigation_in_header-->
<meta name="distill:offset" content="../.."/>

<script type="application/javascript">

  window.headroom_prevent_pin = false;

  window.document.addEventListener("DOMContentLoaded", function (event) {

    // initialize headroom for banner
    var header = $('header').get(0);
    var headerHeight = header.offsetHeight;
    var headroom = new Headroom(header, {
      tolerance: 5,
      onPin : function() {
        if (window.headroom_prevent_pin) {
          window.headroom_prevent_pin = false;
          headroom.unpin();
        }
      }
    });
    headroom.init();
    if(window.location.hash)
      headroom.unpin();
    $(header).addClass('headroom--transition');

    // offset scroll location for banner on hash change
    // (see: https://github.com/WickyNilliams/headroom.js/issues/38)
    window.addEventListener("hashchange", function(event) {
      window.scrollTo(0, window.pageYOffset - (headerHeight + 25));
    });

    // responsive menu
    $('.distill-site-header').each(function(i, val) {
      var topnav = $(this);
      var toggle = topnav.find('.nav-toggle');
      toggle.on('click', function() {
        topnav.toggleClass('responsive');
      });
    });

    // nav dropdowns
    $('.nav-dropbtn').click(function(e) {
      $(this).next('.nav-dropdown-content').toggleClass('nav-dropdown-active');
      $(this).parent().siblings('.nav-dropdown')
         .children('.nav-dropdown-content').removeClass('nav-dropdown-active');
    });
    $("body").click(function(e){
      $('.nav-dropdown-content').removeClass('nav-dropdown-active');
    });
    $(".nav-dropdown").click(function(e){
      e.stopPropagation();
    });
  });
</script>

<style type="text/css">

/* Theme (user-documented overrideables for nav appearance) */

.distill-site-nav {
  color: rgba(255, 255, 255, 0.8);
  background-color: #0F2E3D;
  font-size: 15px;
  font-weight: 300;
}

.distill-site-nav a {
  color: inherit;
  text-decoration: none;
}

.distill-site-nav a:hover {
  color: white;
}

@media print {
  .distill-site-nav {
    display: none;
  }
}

.distill-site-header {

}

.distill-site-footer {

}


/* Site Header */

.distill-site-header {
  width: 100%;
  box-sizing: border-box;
  z-index: 3;
}

.distill-site-header .nav-left {
  display: inline-block;
  margin-left: 8px;
}

@media screen and (max-width: 768px) {
  .distill-site-header .nav-left {
    margin-left: 0;
  }
}


.distill-site-header .nav-right {
  float: right;
  margin-right: 8px;
}

.distill-site-header a,
.distill-site-header .title {
  display: inline-block;
  text-align: center;
  padding: 14px 10px 14px 10px;
}

.distill-site-header .title {
  font-size: 18px;
  min-width: 150px;
}

.distill-site-header .logo {
  padding: 0;
}

.distill-site-header .logo img {
  display: none;
  max-height: 20px;
  width: auto;
  margin-bottom: -4px;
}

.distill-site-header .nav-image img {
  max-height: 18px;
  width: auto;
  display: inline-block;
  margin-bottom: -3px;
}



@media screen and (min-width: 1000px) {
  .distill-site-header .logo img {
    display: inline-block;
  }
  .distill-site-header .nav-left {
    margin-left: 20px;
  }
  .distill-site-header .nav-right {
    margin-right: 20px;
  }
  .distill-site-header .title {
    padding-left: 12px;
  }
}


.distill-site-header .nav-toggle {
  display: none;
}

.nav-dropdown {
  display: inline-block;
  position: relative;
}

.nav-dropdown .nav-dropbtn {
  border: none;
  outline: none;
  color: rgba(255, 255, 255, 0.8);
  padding: 16px 10px;
  background-color: transparent;
  font-family: inherit;
  font-size: inherit;
  font-weight: inherit;
  margin: 0;
  margin-top: 1px;
  z-index: 2;
}

.nav-dropdown-content {
  display: none;
  position: absolute;
  background-color: white;
  min-width: 200px;
  border: 1px solid rgba(0,0,0,0.15);
  border-radius: 4px;
  box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.1);
  z-index: 1;
  margin-top: 2px;
  white-space: nowrap;
  padding-top: 4px;
  padding-bottom: 4px;
}

.nav-dropdown-content hr {
  margin-top: 4px;
  margin-bottom: 4px;
  border: none;
  border-bottom: 1px solid rgba(0, 0, 0, 0.1);
}

.nav-dropdown-active {
  display: block;
}

.nav-dropdown-content a, .nav-dropdown-content .nav-dropdown-header {
  color: black;
  padding: 6px 24px;
  text-decoration: none;
  display: block;
  text-align: left;
}

.nav-dropdown-content .nav-dropdown-header {
  display: block;
  padding: 5px 24px;
  padding-bottom: 0;
  text-transform: uppercase;
  font-size: 14px;
  color: #999999;
  white-space: nowrap;
}

.nav-dropdown:hover .nav-dropbtn {
  color: white;
}

.nav-dropdown-content a:hover {
  background-color: #ddd;
  color: black;
}

.nav-right .nav-dropdown-content {
  margin-left: -45%;
  right: 0;
}

@media screen and (max-width: 768px) {
  .distill-site-header a, .distill-site-header .nav-dropdown  {display: none;}
  .distill-site-header a.nav-toggle {
    float: right;
    display: block;
  }
  .distill-site-header .title {
    margin-left: 0;
  }
  .distill-site-header .nav-right {
    margin-right: 0;
  }
  .distill-site-header {
    overflow: hidden;
  }
  .nav-right .nav-dropdown-content {
    margin-left: 0;
  }
}


@media screen and (max-width: 768px) {
  .distill-site-header.responsive {position: relative; min-height: 500px; }
  .distill-site-header.responsive a.nav-toggle {
    position: absolute;
    right: 0;
    top: 0;
  }
  .distill-site-header.responsive a,
  .distill-site-header.responsive .nav-dropdown {
    display: block;
    text-align: left;
  }
  .distill-site-header.responsive .nav-left,
  .distill-site-header.responsive .nav-right {
    width: 100%;
  }
  .distill-site-header.responsive .nav-dropdown {float: none;}
  .distill-site-header.responsive .nav-dropdown-content {position: relative;}
  .distill-site-header.responsive .nav-dropdown .nav-dropbtn {
    display: block;
    width: 100%;
    text-align: left;
  }
}

/* Site Footer */

.distill-site-footer {
  width: 100%;
  overflow: hidden;
  box-sizing: border-box;
  z-index: 3;
  margin-top: 30px;
  padding-top: 30px;
  padding-bottom: 30px;
  text-align: center;
}

/* Headroom */

d-title {
  padding-top: 6rem;
}

@media print {
  d-title {
    padding-top: 4rem;
  }
}

.headroom {
  z-index: 1000;
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
}

.headroom--transition {
  transition: all .4s ease-in-out;
}

.headroom--unpinned {
  top: -100px;
}

.headroom--pinned {
  top: 0;
}

/* adjust viewport for navbar height */
/* helps vertically center bootstrap (non-distill) content */
.min-vh-100 {
  min-height: calc(100vh - 100px) !important;
}

</style>

<script src="../../site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<link href="../../site_libs/font-awesome-5.1.0/css/all.css" rel="stylesheet"/>
<link href="../../site_libs/font-awesome-5.1.0/css/v4-shims.css" rel="stylesheet"/>
<script src="../../site_libs/headroom-0.9.4/headroom.min.js"></script>
<script src="../../site_libs/autocomplete-0.37.1/autocomplete.min.js"></script>
<script src="../../site_libs/fuse-6.4.1/fuse.min.js"></script>

<script type="application/javascript">

function getMeta(metaName) {
  var metas = document.getElementsByTagName('meta');
  for (let i = 0; i < metas.length; i++) {
    if (metas[i].getAttribute('name') === metaName) {
      return metas[i].getAttribute('content');
    }
  }
  return '';
}

function offsetURL(url) {
  var offset = getMeta('distill:offset');
  return offset ? offset + '/' + url : url;
}

function createFuseIndex() {

  // create fuse index
  var options = {
    keys: [
      { name: 'title', weight: 20 },
      { name: 'categories', weight: 15 },
      { name: 'description', weight: 10 },
      { name: 'contents', weight: 5 },
    ],
    ignoreLocation: true,
    threshold: 0
  };
  var fuse = new window.Fuse([], options);

  // fetch the main search.json
  return fetch(offsetURL('search.json'))
    .then(function(response) {
      if (response.status == 200) {
        return response.json().then(function(json) {
          // index main articles
          json.articles.forEach(function(article) {
            fuse.add(article);
          });
          // download collections and index their articles
          return Promise.all(json.collections.map(function(collection) {
            return fetch(offsetURL(collection)).then(function(response) {
              if (response.status === 200) {
                return response.json().then(function(articles) {
                  articles.forEach(function(article) {
                    fuse.add(article);
                  });
                })
              } else {
                return Promise.reject(
                  new Error('Unexpected status from search index request: ' +
                            response.status)
                );
              }
            });
          })).then(function() {
            return fuse;
          });
        });

      } else {
        return Promise.reject(
          new Error('Unexpected status from search index request: ' +
                      response.status)
        );
      }
    });
}

window.document.addEventListener("DOMContentLoaded", function (event) {

  // get search element (bail if we don't have one)
  var searchEl = window.document.getElementById('distill-search');
  if (!searchEl)
    return;

  createFuseIndex()
    .then(function(fuse) {

      // make search box visible
      searchEl.classList.remove('hidden');

      // initialize autocomplete
      var options = {
        autoselect: true,
        hint: false,
        minLength: 2,
      };
      window.autocomplete(searchEl, options, [{
        source: function(query, callback) {
          const searchOptions = {
            isCaseSensitive: false,
            shouldSort: true,
            minMatchCharLength: 2,
            limit: 10,
          };
          var results = fuse.search(query, searchOptions);
          callback(results
            .map(function(result) { return result.item; })
          );
        },
        templates: {
          suggestion: function(suggestion) {
            var img = suggestion.preview && Object.keys(suggestion.preview).length > 0
              ? `<img src="${offsetURL(suggestion.preview)}"</img>`
              : '';
            var html = `
              <div class="search-item">
                <h3>${suggestion.title}</h3>
                <div class="search-item-description">
                  ${suggestion.description || ''}
                </div>
                <div class="search-item-preview">
                  ${img}
                </div>
              </div>
            `;
            return html;
          }
        }
      }]).on('autocomplete:selected', function(event, suggestion) {
        window.location.href = offsetURL(suggestion.path);
      });
      // remove inline display style on autocompleter (we want to
      // manage responsive display via css)
      $('.algolia-autocomplete').css("display", "");
    })
    .catch(function(error) {
      console.log(error);
    });

});

</script>

<style type="text/css">

.nav-search {
  font-size: x-small;
}

/* Algolioa Autocomplete */

.algolia-autocomplete {
  display: inline-block;
  margin-left: 10px;
  vertical-align: sub;
  background-color: white;
  color: black;
  padding: 6px;
  padding-top: 8px;
  padding-bottom: 0;
  border-radius: 6px;
  border: 1px #0F2E3D solid;
  width: 180px;
}


@media screen and (max-width: 768px) {
  .distill-site-nav .algolia-autocomplete {
    display: none;
    visibility: hidden;
  }
  .distill-site-nav.responsive .algolia-autocomplete {
    display: inline-block;
    visibility: visible;
  }
  .distill-site-nav.responsive .algolia-autocomplete .aa-dropdown-menu {
    margin-left: 0;
    width: 400px;
    max-height: 400px;
  }
}

.algolia-autocomplete .aa-input, .algolia-autocomplete .aa-hint {
  width: 90%;
  outline: none;
  border: none;
}

.algolia-autocomplete .aa-hint {
  color: #999;
}
.algolia-autocomplete .aa-dropdown-menu {
  width: 550px;
  max-height: 70vh;
  overflow-x: visible;
  overflow-y: scroll;
  padding: 5px;
  margin-top: 3px;
  margin-left: -150px;
  background-color: #fff;
  border-radius: 5px;
  border: 1px solid #999;
  border-top: none;
}

.algolia-autocomplete .aa-dropdown-menu .aa-suggestion {
  cursor: pointer;
  padding: 5px 4px;
  border-bottom: 1px solid #eee;
}

.algolia-autocomplete .aa-dropdown-menu .aa-suggestion:last-of-type {
  border-bottom: none;
  margin-bottom: 2px;
}

.algolia-autocomplete .aa-dropdown-menu .aa-suggestion .search-item {
  overflow: hidden;
  font-size: 0.8em;
  line-height: 1.4em;
}

.algolia-autocomplete .aa-dropdown-menu .aa-suggestion .search-item h3 {
  font-size: 1rem;
  margin-block-start: 0;
  margin-block-end: 5px;
}

.algolia-autocomplete .aa-dropdown-menu .aa-suggestion .search-item-description {
  display: inline-block;
  overflow: hidden;
  height: 2.8em;
  width: 80%;
  margin-right: 4%;
}

.algolia-autocomplete .aa-dropdown-menu .aa-suggestion .search-item-preview {
  display: inline-block;
  width: 15%;
}

.algolia-autocomplete .aa-dropdown-menu .aa-suggestion .search-item-preview img {
  height: 3em;
  width: auto;
  display: none;
}

.algolia-autocomplete .aa-dropdown-menu .aa-suggestion .search-item-preview img[src] {
  display: initial;
}

.algolia-autocomplete .aa-dropdown-menu .aa-suggestion.aa-cursor {
  background-color: #eee;
}
.algolia-autocomplete .aa-dropdown-menu .aa-suggestion em {
  font-weight: bold;
  font-style: normal;
}

</style>


<!--/radix_placeholder_navigation_in_header-->
  <!--radix_placeholder_distill-->

<style type="text/css">

body {
  background-color: white;
}

.pandoc-table {
  width: 100%;
}

.pandoc-table>caption {
  margin-bottom: 10px;
}

.pandoc-table th:not([align]) {
  text-align: left;
}

.pagedtable-footer {
  font-size: 15px;
}

d-byline .byline {
  grid-template-columns: 2fr 2fr;
}

d-byline .byline h3 {
  margin-block-start: 1.5em;
}

d-byline .byline .authors-affiliations h3 {
  margin-block-start: 0.5em;
}

.authors-affiliations .orcid-id {
  width: 16px;
  height:16px;
  margin-left: 4px;
  margin-right: 4px;
  vertical-align: middle;
  padding-bottom: 2px;
}

d-title .dt-tags {
  margin-top: 1em;
  grid-column: text;
}

.dt-tags .dt-tag {
  text-decoration: none;
  display: inline-block;
  color: rgba(0,0,0,0.6);
  padding: 0em 0.4em;
  margin-right: 0.5em;
  margin-bottom: 0.4em;
  font-size: 70%;
  border: 1px solid rgba(0,0,0,0.2);
  border-radius: 3px;
  text-transform: uppercase;
  font-weight: 500;
}

d-article table.gt_table td,
d-article table.gt_table th {
  border-bottom: none;
}

.html-widget {
  margin-bottom: 2.0em;
}

.l-screen-inset {
  padding-right: 16px;
}

.l-screen .caption {
  margin-left: 10px;
}

.shaded {
  background: rgb(247, 247, 247);
  padding-top: 20px;
  padding-bottom: 20px;
  border-top: 1px solid rgba(0, 0, 0, 0.1);
  border-bottom: 1px solid rgba(0, 0, 0, 0.1);
}

.shaded .html-widget {
  margin-bottom: 0;
  border: 1px solid rgba(0, 0, 0, 0.1);
}

.shaded .shaded-content {
  background: white;
}

.text-output {
  margin-top: 0;
  line-height: 1.5em;
}

.hidden {
  display: none !important;
}

d-article {
  padding-top: 2.5rem;
  padding-bottom: 30px;
}

d-appendix {
  padding-top: 30px;
}

d-article>p>img {
  width: 100%;
}

d-article h2 {
  margin: 1rem 0 1.5rem 0;
}

d-article h3 {
  margin-top: 1.5rem;
}

d-article iframe {
  border: 1px solid rgba(0, 0, 0, 0.1);
  margin-bottom: 2.0em;
  width: 100%;
}

/* Tweak code blocks */

d-article div.sourceCode code,
d-article pre code {
  font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
}

d-article pre,
d-article div.sourceCode,
d-article div.sourceCode pre {
  overflow: auto;
}

d-article div.sourceCode {
  background-color: white;
}

d-article div.sourceCode pre {
  padding-left: 10px;
  font-size: 12px;
  border-left: 2px solid rgba(0,0,0,0.1);
}

d-article pre {
  font-size: 12px;
  color: black;
  background: none;
  margin-top: 0;
  text-align: left;
  white-space: pre;
  word-spacing: normal;
  word-break: normal;
  word-wrap: normal;
  line-height: 1.5;

  -moz-tab-size: 4;
  -o-tab-size: 4;
  tab-size: 4;

  -webkit-hyphens: none;
  -moz-hyphens: none;
  -ms-hyphens: none;
  hyphens: none;
}

d-article pre a {
  border-bottom: none;
}

d-article pre a:hover {
  border-bottom: none;
  text-decoration: underline;
}

d-article details {
  grid-column: text;
  margin-bottom: 0.8em;
}

@media(min-width: 768px) {

d-article pre,
d-article div.sourceCode,
d-article div.sourceCode pre {
  overflow: visible !important;
}

d-article div.sourceCode pre {
  padding-left: 18px;
  font-size: 14px;
}

d-article pre {
  font-size: 14px;
}

}

figure img.external {
  background: white;
  border: 1px solid rgba(0, 0, 0, 0.1);
  box-shadow: 0 1px 8px rgba(0, 0, 0, 0.1);
  padding: 18px;
  box-sizing: border-box;
}

/* CSS for d-contents */

.d-contents {
  grid-column: text;
  color: rgba(0,0,0,0.8);
  font-size: 0.9em;
  padding-bottom: 1em;
  margin-bottom: 1em;
  padding-bottom: 0.5em;
  margin-bottom: 1em;
  padding-left: 0.25em;
  justify-self: start;
}

@media(min-width: 1000px) {
  .d-contents.d-contents-float {
    height: 0;
    grid-column-start: 1;
    grid-column-end: 4;
    justify-self: center;
    padding-right: 3em;
    padding-left: 2em;
  }
}

.d-contents nav h3 {
  font-size: 18px;
  margin-top: 0;
  margin-bottom: 1em;
}

.d-contents li {
  list-style-type: none
}

.d-contents nav > ul {
  padding-left: 0;
}

.d-contents ul {
  padding-left: 1em
}

.d-contents nav ul li {
  margin-top: 0.6em;
  margin-bottom: 0.2em;
}

.d-contents nav a {
  font-size: 13px;
  border-bottom: none;
  text-decoration: none
  color: rgba(0, 0, 0, 0.8);
}

.d-contents nav a:hover {
  text-decoration: underline solid rgba(0, 0, 0, 0.6)
}

.d-contents nav > ul > li > a {
  font-weight: 600;
}

.d-contents nav > ul > li > ul {
  font-weight: inherit;
}

.d-contents nav > ul > li > ul > li {
  margin-top: 0.2em;
}


.d-contents nav ul {
  margin-top: 0;
  margin-bottom: 0.25em;
}

.d-article-with-toc h2:nth-child(2) {
  margin-top: 0;
}


/* Figure */

.figure {
  position: relative;
  margin-bottom: 2.5em;
  margin-top: 1.5em;
}

.figure .caption {
  color: rgba(0, 0, 0, 0.6);
  font-size: 12px;
  line-height: 1.5em;
}

.figure img.external {
  background: white;
  border: 1px solid rgba(0, 0, 0, 0.1);
  box-shadow: 0 1px 8px rgba(0, 0, 0, 0.1);
  padding: 18px;
  box-sizing: border-box;
}

.figure .caption a {
  color: rgba(0, 0, 0, 0.6);
}

.figure .caption b,
.figure .caption strong, {
  font-weight: 600;
  color: rgba(0, 0, 0, 1.0);
}

/* Citations */

d-article .citation {
  color: inherit;
  cursor: inherit;
}

div.hanging-indent{
  margin-left: 1em; text-indent: -1em;
}

/* Citation hover box */

.tippy-box[data-theme~=light-border] {
  background-color: rgba(250, 250, 250, 0.95);
}

.tippy-content > p {
  margin-bottom: 0;
  padding: 2px;
}


/* Tweak 1000px media break to show more text */

@media(min-width: 1000px) {
  .base-grid,
  distill-header,
  d-title,
  d-abstract,
  d-article,
  d-appendix,
  distill-appendix,
  d-byline,
  d-footnote-list,
  d-citation-list,
  distill-footer {
    grid-template-columns: [screen-start] 1fr [page-start kicker-start] 80px [middle-start] 50px [text-start kicker-end] 65px 65px 65px 65px 65px 65px 65px 65px [text-end gutter-start] 65px [middle-end] 65px [page-end gutter-end] 1fr [screen-end];
    grid-column-gap: 16px;
  }

  .grid {
    grid-column-gap: 16px;
  }

  d-article {
    font-size: 1.06rem;
    line-height: 1.7em;
  }
  figure .caption, .figure .caption, figure figcaption {
    font-size: 13px;
  }
}

@media(min-width: 1180px) {
  .base-grid,
  distill-header,
  d-title,
  d-abstract,
  d-article,
  d-appendix,
  distill-appendix,
  d-byline,
  d-footnote-list,
  d-citation-list,
  distill-footer {
    grid-template-columns: [screen-start] 1fr [page-start kicker-start] 60px [middle-start] 60px [text-start kicker-end] 60px 60px 60px 60px 60px 60px 60px 60px [text-end gutter-start] 60px [middle-end] 60px [page-end gutter-end] 1fr [screen-end];
    grid-column-gap: 32px;
  }

  .grid {
    grid-column-gap: 32px;
  }
}


/* Get the citation styles for the appendix (not auto-injected on render since
   we do our own rendering of the citation appendix) */

d-appendix .citation-appendix,
.d-appendix .citation-appendix {
  font-size: 11px;
  line-height: 15px;
  border-left: 1px solid rgba(0, 0, 0, 0.1);
  padding-left: 18px;
  border: 1px solid rgba(0,0,0,0.1);
  background: rgba(0, 0, 0, 0.02);
  padding: 10px 18px;
  border-radius: 3px;
  color: rgba(150, 150, 150, 1);
  overflow: hidden;
  margin-top: -12px;
  white-space: pre-wrap;
  word-wrap: break-word;
}

/* Include appendix styles here so they can be overridden */

d-appendix {
  contain: layout style;
  font-size: 0.8em;
  line-height: 1.7em;
  margin-top: 60px;
  margin-bottom: 0;
  border-top: 1px solid rgba(0, 0, 0, 0.1);
  color: rgba(0,0,0,0.5);
  padding-top: 60px;
  padding-bottom: 48px;
}

d-appendix h3 {
  grid-column: page-start / text-start;
  font-size: 15px;
  font-weight: 500;
  margin-top: 1em;
  margin-bottom: 0;
  color: rgba(0,0,0,0.65);
}

d-appendix h3 + * {
  margin-top: 1em;
}

d-appendix ol {
  padding: 0 0 0 15px;
}

@media (min-width: 768px) {
  d-appendix ol {
    padding: 0 0 0 30px;
    margin-left: -30px;
  }
}

d-appendix li {
  margin-bottom: 1em;
}

d-appendix a {
  color: rgba(0, 0, 0, 0.6);
}

d-appendix > * {
  grid-column: text;
}

d-appendix > d-footnote-list,
d-appendix > d-citation-list,
d-appendix > distill-appendix {
  grid-column: screen;
}

/* Include footnote styles here so they can be overridden */

d-footnote-list {
  contain: layout style;
}

d-footnote-list > * {
  grid-column: text;
}

d-footnote-list a.footnote-backlink {
  color: rgba(0,0,0,0.3);
  padding-left: 0.5em;
}



/* Anchor.js */

.anchorjs-link {
  /*transition: all .25s linear; */
  text-decoration: none;
  border-bottom: none;
}
*:hover > .anchorjs-link {
  margin-left: -1.125em !important;
  text-decoration: none;
  border-bottom: none;
}

/* Social footer */

.social_footer {
  margin-top: 30px;
  margin-bottom: 0;
  color: rgba(0,0,0,0.67);
}

.disqus-comments {
  margin-right: 30px;
}

.disqus-comment-count {
  border-bottom: 1px solid rgba(0, 0, 0, 0.4);
  cursor: pointer;
}

#disqus_thread {
  margin-top: 30px;
}

.article-sharing a {
  border-bottom: none;
  margin-right: 8px;
}

.article-sharing a:hover {
  border-bottom: none;
}

.sidebar-section.subscribe {
  font-size: 12px;
  line-height: 1.6em;
}

.subscribe p {
  margin-bottom: 0.5em;
}


.article-footer .subscribe {
  font-size: 15px;
  margin-top: 45px;
}


.sidebar-section.custom {
  font-size: 12px;
  line-height: 1.6em;
}

.custom p {
  margin-bottom: 0.5em;
}

/* Styles for listing layout (hide title) */
.layout-listing d-title, .layout-listing .d-title {
  display: none;
}

/* Styles for posts lists (not auto-injected) */


.posts-with-sidebar {
  padding-left: 45px;
  padding-right: 45px;
}

.posts-list .description h2,
.posts-list .description p {
  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", Arial, sans-serif;
}

.posts-list .description h2 {
  font-weight: 700;
  border-bottom: none;
  padding-bottom: 0;
}

.posts-list h2.post-tag {
  border-bottom: 1px solid rgba(0, 0, 0, 0.2);
  padding-bottom: 12px;
}
.posts-list {
  margin-top: 60px;
  margin-bottom: 24px;
}

.posts-list .post-preview {
  text-decoration: none;
  overflow: hidden;
  display: block;
  border-bottom: 1px solid rgba(0, 0, 0, 0.1);
  padding: 24px 0;
}

.post-preview-last {
  border-bottom: none !important;
}

.posts-list .posts-list-caption {
  grid-column: screen;
  font-weight: 400;
}

.posts-list .post-preview h2 {
  margin: 0 0 6px 0;
  line-height: 1.2em;
  font-style: normal;
  font-size: 24px;
}

.posts-list .post-preview p {
  margin: 0 0 12px 0;
  line-height: 1.4em;
  font-size: 16px;
}

.posts-list .post-preview .thumbnail {
  box-sizing: border-box;
  margin-bottom: 24px;
  position: relative;
  max-width: 500px;
}
.posts-list .post-preview img {
  width: 100%;
  display: block;
}

.posts-list .metadata {
  font-size: 12px;
  line-height: 1.4em;
  margin-bottom: 18px;
}

.posts-list .metadata > * {
  display: inline-block;
}

.posts-list .metadata .publishedDate {
  margin-right: 2em;
}

.posts-list .metadata .dt-authors {
  display: block;
  margin-top: 0.3em;
  margin-right: 2em;
}

.posts-list .dt-tags {
  display: block;
  line-height: 1em;
}

.posts-list .dt-tags .dt-tag {
  display: inline-block;
  color: rgba(0,0,0,0.6);
  padding: 0.3em 0.4em;
  margin-right: 0.2em;
  margin-bottom: 0.4em;
  font-size: 60%;
  border: 1px solid rgba(0,0,0,0.2);
  border-radius: 3px;
  text-transform: uppercase;
  font-weight: 500;
}

.posts-list img {
  opacity: 1;
}

.posts-list img[data-src] {
  opacity: 0;
}

.posts-more {
  clear: both;
}


.posts-sidebar {
  font-size: 16px;
}

.posts-sidebar h3 {
  font-size: 16px;
  margin-top: 0;
  margin-bottom: 0.5em;
  font-weight: 400;
  text-transform: uppercase;
}

.sidebar-section {
  margin-bottom: 30px;
}

.categories ul {
  list-style-type: none;
  margin: 0;
  padding: 0;
}

.categories li {
  color: rgba(0, 0, 0, 0.8);
  margin-bottom: 0;
}

.categories li>a {
  border-bottom: none;
}

.categories li>a:hover {
  border-bottom: 1px solid rgba(0, 0, 0, 0.4);
}

.categories .active {
  font-weight: 600;
}

.categories .category-count {
  color: rgba(0, 0, 0, 0.4);
}


@media(min-width: 768px) {
  .posts-list .post-preview h2 {
    font-size: 26px;
  }
  .posts-list .post-preview .thumbnail {
    float: right;
    width: 30%;
    margin-bottom: 0;
  }
  .posts-list .post-preview .description {
    float: left;
    width: 45%;
  }
  .posts-list .post-preview .metadata {
    float: left;
    width: 20%;
    margin-top: 8px;
  }
  .posts-list .post-preview p {
    margin: 0 0 12px 0;
    line-height: 1.5em;
    font-size: 16px;
  }
  .posts-with-sidebar .posts-list {
    float: left;
    width: 75%;
  }
  .posts-with-sidebar .posts-sidebar {
    float: right;
    width: 20%;
    margin-top: 60px;
    padding-top: 24px;
    padding-bottom: 24px;
  }
}


/* Improve display for browsers without grid (IE/Edge <= 15) */

.downlevel {
  line-height: 1.6em;
  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", Arial, sans-serif;
  margin: 0;
}

.downlevel .d-title {
  padding-top: 6rem;
  padding-bottom: 1.5rem;
}

.downlevel .d-title h1 {
  font-size: 50px;
  font-weight: 700;
  line-height: 1.1em;
  margin: 0 0 0.5rem;
}

.downlevel .d-title p {
  font-weight: 300;
  font-size: 1.2rem;
  line-height: 1.55em;
  margin-top: 0;
}

.downlevel .d-byline {
  padding-top: 0.8em;
  padding-bottom: 0.8em;
  font-size: 0.8rem;
  line-height: 1.8em;
}

.downlevel .section-separator {
  border: none;
  border-top: 1px solid rgba(0, 0, 0, 0.1);
}

.downlevel .d-article {
  font-size: 1.06rem;
  line-height: 1.7em;
  padding-top: 1rem;
  padding-bottom: 2rem;
}


.downlevel .d-appendix {
  padding-left: 0;
  padding-right: 0;
  max-width: none;
  font-size: 0.8em;
  line-height: 1.7em;
  margin-bottom: 0;
  color: rgba(0,0,0,0.5);
  padding-top: 40px;
  padding-bottom: 48px;
}

.downlevel .footnotes ol {
  padding-left: 13px;
}

.downlevel .base-grid,
.downlevel .distill-header,
.downlevel .d-title,
.downlevel .d-abstract,
.downlevel .d-article,
.downlevel .d-appendix,
.downlevel .distill-appendix,
.downlevel .d-byline,
.downlevel .d-footnote-list,
.downlevel .d-citation-list,
.downlevel .distill-footer,
.downlevel .appendix-bottom,
.downlevel .posts-container {
  padding-left: 40px;
  padding-right: 40px;
}

@media(min-width: 768px) {
  .downlevel .base-grid,
  .downlevel .distill-header,
  .downlevel .d-title,
  .downlevel .d-abstract,
  .downlevel .d-article,
  .downlevel .d-appendix,
  .downlevel .distill-appendix,
  .downlevel .d-byline,
  .downlevel .d-footnote-list,
  .downlevel .d-citation-list,
  .downlevel .distill-footer,
  .downlevel .appendix-bottom,
  .downlevel .posts-container {
  padding-left: 150px;
  padding-right: 150px;
  max-width: 900px;
}
}

.downlevel pre code {
  display: block;
  border-left: 2px solid rgba(0, 0, 0, .1);
  padding: 0 0 0 20px;
  font-size: 14px;
}

.downlevel code, .downlevel pre {
  color: black;
  background: none;
  font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
  text-align: left;
  white-space: pre;
  word-spacing: normal;
  word-break: normal;
  word-wrap: normal;
  line-height: 1.5;

  -moz-tab-size: 4;
  -o-tab-size: 4;
  tab-size: 4;

  -webkit-hyphens: none;
  -moz-hyphens: none;
  -ms-hyphens: none;
  hyphens: none;
}

.downlevel .posts-list .post-preview {
  color: inherit;
}



</style>

<script type="application/javascript">

function is_downlevel_browser() {
  if (bowser.isUnsupportedBrowser({ msie: "12", msedge: "16"},
                                 window.navigator.userAgent)) {
    return true;
  } else {
    return window.load_distill_framework === undefined;
  }
}

// show body when load is complete
function on_load_complete() {

  // add anchors
  if (window.anchors) {
    window.anchors.options.placement = 'left';
    window.anchors.add('d-article > h2, d-article > h3, d-article > h4, d-article > h5');
  }


  // set body to visible
  document.body.style.visibility = 'visible';

  // force redraw for leaflet widgets
  if (window.HTMLWidgets) {
    var maps = window.HTMLWidgets.findAll(".leaflet");
    $.each(maps, function(i, el) {
      var map = this.getMap();
      map.invalidateSize();
      map.eachLayer(function(layer) {
        if (layer instanceof L.TileLayer)
          layer.redraw();
      });
    });
  }

  // trigger 'shown' so htmlwidgets resize
  $('d-article').trigger('shown');
}

function init_distill() {

  init_common();

  // create front matter
  var front_matter = $('<d-front-matter></d-front-matter>');
  $('#distill-front-matter').wrap(front_matter);

  // create d-title
  $('.d-title').changeElementType('d-title');

  // create d-byline
  var byline = $('<d-byline></d-byline>');
  $('.d-byline').replaceWith(byline);

  // create d-article
  var article = $('<d-article></d-article>');
  $('.d-article').wrap(article).children().unwrap();

  // move posts container into article
  $('.posts-container').appendTo($('d-article'));

  // create d-appendix
  $('.d-appendix').changeElementType('d-appendix');

  // flag indicating that we have appendix items
  var appendix = $('.appendix-bottom').children('h3').length > 0;

  // replace footnotes with <d-footnote>
  $('.footnote-ref').each(function(i, val) {
    appendix = true;
    var href = $(this).attr('href');
    var id = href.replace('#', '');
    var fn = $('#' + id);
    var fn_p = $('#' + id + '>p');
    fn_p.find('.footnote-back').remove();
    var text = fn_p.html();
    var dtfn = $('<d-footnote></d-footnote>');
    dtfn.html(text);
    $(this).replaceWith(dtfn);
  });
  // remove footnotes
  $('.footnotes').remove();

  // move refs into #references-listing
  $('#references-listing').replaceWith($('#refs'));

  $('h1.appendix, h2.appendix').each(function(i, val) {
    $(this).changeElementType('h3');
  });
  $('h3.appendix').each(function(i, val) {
    var id = $(this).attr('id');
    $('.d-contents a[href="#' + id + '"]').parent().remove();
    appendix = true;
    $(this).nextUntil($('h1, h2, h3')).addBack().appendTo($('d-appendix'));
  });

  // show d-appendix if we have appendix content
  $("d-appendix").css('display', appendix ? 'grid' : 'none');

  // localize layout chunks to just output
  $('.layout-chunk').each(function(i, val) {

    // capture layout
    var layout = $(this).attr('data-layout');

    // apply layout to markdown level block elements
    var elements = $(this).children().not('details, div.sourceCode, pre, script');
    elements.each(function(i, el) {
      var layout_div = $('<div class="' + layout + '"></div>');
      if (layout_div.hasClass('shaded')) {
        var shaded_content = $('<div class="shaded-content"></div>');
        $(this).wrap(shaded_content);
        $(this).parent().wrap(layout_div);
      } else {
        $(this).wrap(layout_div);
      }
    });


    // unwrap the layout-chunk div
    $(this).children().unwrap();
  });

  // remove code block used to force  highlighting css
  $('.distill-force-highlighting-css').parent().remove();

  // remove empty line numbers inserted by pandoc when using a
  // custom syntax highlighting theme
  $('code.sourceCode a:empty').remove();

  // load distill framework
  load_distill_framework();

  // wait for window.distillRunlevel == 4 to do post processing
  function distill_post_process() {

    if (!window.distillRunlevel || window.distillRunlevel < 4)
      return;

    // hide author/affiliations entirely if we have no authors
    var front_matter = JSON.parse($("#distill-front-matter").html());
    var have_authors = front_matter.authors && front_matter.authors.length > 0;
    if (!have_authors)
      $('d-byline').addClass('hidden');

    // article with toc class
    $('.d-contents').parent().addClass('d-article-with-toc');

    // strip links that point to #
    $('.authors-affiliations').find('a[href="#"]').removeAttr('href');

    // add orcid ids
    $('.authors-affiliations').find('.author').each(function(i, el) {
      var orcid_id = front_matter.authors[i].orcidID;
      if (orcid_id) {
        var a = $('<a></a>');
        a.attr('href', 'https://orcid.org/' + orcid_id);
        var img = $('<img></img>');
        img.addClass('orcid-id');
        img.attr('alt', 'ORCID ID');
        img.attr('src','data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA2ZpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDo1N0NEMjA4MDI1MjA2ODExOTk0QzkzNTEzRjZEQTg1NyIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDozM0NDOEJGNEZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDozM0NDOEJGM0ZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ1M1IE1hY2ludG9zaCI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOkZDN0YxMTc0MDcyMDY4MTE5NUZFRDc5MUM2MUUwNEREIiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOjU3Q0QyMDgwMjUyMDY4MTE5OTRDOTM1MTNGNkRBODU3Ii8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+84NovQAAAR1JREFUeNpiZEADy85ZJgCpeCB2QJM6AMQLo4yOL0AWZETSqACk1gOxAQN+cAGIA4EGPQBxmJA0nwdpjjQ8xqArmczw5tMHXAaALDgP1QMxAGqzAAPxQACqh4ER6uf5MBlkm0X4EGayMfMw/Pr7Bd2gRBZogMFBrv01hisv5jLsv9nLAPIOMnjy8RDDyYctyAbFM2EJbRQw+aAWw/LzVgx7b+cwCHKqMhjJFCBLOzAR6+lXX84xnHjYyqAo5IUizkRCwIENQQckGSDGY4TVgAPEaraQr2a4/24bSuoExcJCfAEJihXkWDj3ZAKy9EJGaEo8T0QSxkjSwORsCAuDQCD+QILmD1A9kECEZgxDaEZhICIzGcIyEyOl2RkgwAAhkmC+eAm0TAAAAABJRU5ErkJggg==');
        a.append(img);
        $(this).append(a);
      }
    });

    // hide elements of author/affiliations grid that have no value
    function hide_byline_column(caption) {
      $('d-byline').find('h3:contains("' + caption + '")').parent().css('visibility', 'hidden');
    }

    // affiliations
    var have_affiliations = false;
    for (var i = 0; i<front_matter.authors.length; ++i) {
      var author = front_matter.authors[i];
      if (author.affiliation !== "&nbsp;") {
        have_affiliations = true;
        break;
      }
    }
    if (!have_affiliations)
      $('d-byline').find('h3:contains("Affiliations")').css('visibility', 'hidden');

    // published date
    if (!front_matter.publishedDate)
      hide_byline_column("Published");

    // document object identifier
    var doi = $('d-byline').find('h3:contains("DOI")');
    var doi_p = doi.next().empty();
    if (!front_matter.doi) {
      // if we have a citation and valid citationText then link to that
      if ($('#citation').length > 0 && front_matter.citationText) {
        doi.html('Citation');
        $('<a href="#citation"></a>')
          .text(front_matter.citationText)
          .appendTo(doi_p);
      } else {
        hide_byline_column("DOI");
      }
    } else {
      $('<a></a>')
         .attr('href', "https://doi.org/" + front_matter.doi)
         .html(front_matter.doi)
         .appendTo(doi_p);
    }

     // change plural form of authors/affiliations
    if (front_matter.authors.length === 1) {
      var grid = $('.authors-affiliations');
      grid.children('h3:contains("Authors")').text('Author');
      grid.children('h3:contains("Affiliations")').text('Affiliation');
    }

    // remove d-appendix and d-footnote-list local styles
    $('d-appendix > style:first-child').remove();
    $('d-footnote-list > style:first-child').remove();

    // move appendix-bottom entries to the bottom
    $('.appendix-bottom').appendTo('d-appendix').children().unwrap();
    $('.appendix-bottom').remove();

    // hoverable references
    $('span.citation[data-cites]').each(function() {
      if ($(this).children()[0].nodeName == "D-FOOTNOTE") {
        var fn = $(this).children()[0]
        $(this).html(fn.shadowRoot.querySelector("sup"))
        $(this).id = fn.id
        fn.remove()
      }
      var refs = $(this).attr('data-cites').split(" ");
      var refHtml = refs.map(function(ref) {
        return "<p>" + $('#ref-' + ref).html() + "</p>";
      }).join("\n");
      window.tippy(this, {
        allowHTML: true,
        content: refHtml,
        maxWidth: 500,
        interactive: true,
        interactiveBorder: 10,
        theme: 'light-border',
        placement: 'bottom-start'
      });
    });

    // fix footnotes in tables (#411)
    // replacing broken distill.pub feature
    $('table d-footnote').each(function() {
      // we replace internal showAtNode methode which is triggered when hovering a footnote
      this.hoverBox.showAtNode = function(node) {
        // ported from https://github.com/distillpub/template/pull/105/files
        calcOffset = function(elem) {
            let x = elem.offsetLeft;
            let y = elem.offsetTop;
            // Traverse upwards until an `absolute` element is found or `elem`
            // becomes null.
            while (elem = elem.offsetParent && elem.style.position != 'absolute') {
                x += elem.offsetLeft;
                y += elem.offsetTop;
            }

            return { left: x, top: y };
        }
        // https://developer.mozilla.org/en-US/docs/Web/API/HTMLElement/offsetTop
        const bbox = node.getBoundingClientRect();
        const offset = calcOffset(node);
        this.show([offset.left + bbox.width, offset.top + bbox.height]);
      }
    })

    // clear polling timer
    clearInterval(tid);

    // show body now that everything is ready
    on_load_complete();
  }

  var tid = setInterval(distill_post_process, 50);
  distill_post_process();

}

function init_downlevel() {

  init_common();

   // insert hr after d-title
  $('.d-title').after($('<hr class="section-separator"/>'));

  // check if we have authors
  var front_matter = JSON.parse($("#distill-front-matter").html());
  var have_authors = front_matter.authors && front_matter.authors.length > 0;

  // manage byline/border
  if (!have_authors)
    $('.d-byline').remove();
  $('.d-byline').after($('<hr class="section-separator"/>'));
  $('.d-byline a').remove();

  // remove toc
  $('.d-contents').remove();

  // move appendix elements
  $('h1.appendix, h2.appendix').each(function(i, val) {
    $(this).changeElementType('h3');
  });
  $('h3.appendix').each(function(i, val) {
    $(this).nextUntil($('h1, h2, h3')).addBack().appendTo($('.d-appendix'));
  });


  // inject headers into references and footnotes
  var refs_header = $('<h3></h3>');
  refs_header.text('References');
  $('#refs').prepend(refs_header);

  var footnotes_header = $('<h3></h3');
  footnotes_header.text('Footnotes');
  $('.footnotes').children('hr').first().replaceWith(footnotes_header);

  // move appendix-bottom entries to the bottom
  $('.appendix-bottom').appendTo('.d-appendix').children().unwrap();
  $('.appendix-bottom').remove();

  // remove appendix if it's empty
  if ($('.d-appendix').children().length === 0)
    $('.d-appendix').remove();

  // prepend separator above appendix
  $('.d-appendix').before($('<hr class="section-separator" style="clear: both"/>'));

  // trim code
  $('pre>code').each(function(i, val) {
    $(this).html($.trim($(this).html()));
  });

  // move posts-container right before article
  $('.posts-container').insertBefore($('.d-article'));

  $('body').addClass('downlevel');

  on_load_complete();
}


function init_common() {

  // jquery plugin to change element types
  (function($) {
    $.fn.changeElementType = function(newType) {
      var attrs = {};

      $.each(this[0].attributes, function(idx, attr) {
        attrs[attr.nodeName] = attr.nodeValue;
      });

      this.replaceWith(function() {
        return $("<" + newType + "/>", attrs).append($(this).contents());
      });
    };
  })(jQuery);

  // prevent underline for linked images
  $('a > img').parent().css({'border-bottom' : 'none'});

  // mark non-body figures created by knitr chunks as 100% width
  $('.layout-chunk').each(function(i, val) {
    var figures = $(this).find('img, .html-widget');
    // ignore leaflet img layers (#106)
    figures = figures.filter(':not(img[class*="leaflet"])')
    if ($(this).attr('data-layout') !== "l-body") {
      figures.css('width', '100%');
    } else {
      figures.css('max-width', '100%');
      figures.filter("[width]").each(function(i, val) {
        var fig = $(this);
        fig.css('width', fig.attr('width') + 'px');
      });

    }
  });

  // auto-append index.html to post-preview links in file: protocol
  // and in rstudio ide preview
  $('.post-preview').each(function(i, val) {
    if (window.location.protocol === "file:")
      $(this).attr('href', $(this).attr('href') + "index.html");
  });

  // get rid of index.html references in header
  if (window.location.protocol !== "file:") {
    $('.distill-site-header a[href]').each(function(i,val) {
      $(this).attr('href', $(this).attr('href').replace(/^index[.]html/, "./"));
    });
  }

  // add class to pandoc style tables
  $('tr.header').parent('thead').parent('table').addClass('pandoc-table');
  $('.kable-table').children('table').addClass('pandoc-table');

  // add figcaption style to table captions
  $('caption').parent('table').addClass("figcaption");

  // initialize posts list
  if (window.init_posts_list)
    window.init_posts_list();

  // implmement disqus comment link
  $('.disqus-comment-count').click(function() {
    window.headroom_prevent_pin = true;
    $('#disqus_thread').toggleClass('hidden');
    if (!$('#disqus_thread').hasClass('hidden')) {
      var offset = $(this).offset();
      $(window).resize();
      $('html, body').animate({
        scrollTop: offset.top - 35
      });
    }
  });
}

document.addEventListener('DOMContentLoaded', function() {
  if (is_downlevel_browser())
    init_downlevel();
  else
    window.addEventListener('WebComponentsReady', init_distill);
});

</script>

<style type="text/css">
/* base variables */

/* Edit the CSS properties in this file to create a custom
   Distill theme. Only edit values in the right column
   for each row; values shown are the CSS defaults.
   To return any property to the default,
   you may set its value to: unset
   All rows must end with a semi-colon.                      */

/* Optional: embed custom fonts here with `@import`          */
/* This must remain at the top of this file.                 */



html {
  /*-- Main font sizes --*/
  --title-size:      50px;
  --body-size:       1.06rem;
  --code-size:       14px;
  --aside-size:      12px;
  --fig-cap-size:    13px;
  /*-- Main font colors --*/
  --title-color:     #000000;
  --header-color:    rgba(0, 0, 0, 0.8);
  --body-color:      rgba(0, 0, 0, 0.8);
  --aside-color:     rgba(0, 0, 0, 0.6);
  --fig-cap-color:   rgba(0, 0, 0, 0.6);
  /*-- Specify custom fonts ~~~ must be imported above   --*/
  --heading-font:    sans-serif;
  --mono-font:       monospace;
  --body-font:       sans-serif;
  --navbar-font:     sans-serif;  /* websites + blogs only */
}

/*-- ARTICLE METADATA --*/
d-byline {
  --heading-size:    0.6rem;
  --heading-color:   rgba(0, 0, 0, 0.5);
  --body-size:       0.8rem;
  --body-color:      rgba(0, 0, 0, 0.8);
}

/*-- ARTICLE TABLE OF CONTENTS --*/
.d-contents {
  --heading-size:    18px;
  --contents-size:   13px;
}

/*-- ARTICLE APPENDIX --*/
d-appendix {
  --heading-size:    15px;
  --heading-color:   rgba(0, 0, 0, 0.65);
  --text-size:       0.8em;
  --text-color:      rgba(0, 0, 0, 0.5);
}

/*-- WEBSITE HEADER + FOOTER --*/
/* These properties only apply to Distill sites and blogs  */

.distill-site-header {
  --title-size:       18px;
  --text-color:       rgba(255, 255, 255, 0.8);
  --text-size:        15px;
  --hover-color:      white;
  --bkgd-color:       #0F2E3D;
}

.distill-site-footer {
  --text-color:       rgba(255, 255, 255, 0.8);
  --text-size:        15px;
  --hover-color:      white;
  --bkgd-color:       #0F2E3D;
}

/*-- Additional custom styles --*/
/* Add any additional CSS rules below                      */
</style>
<style type="text/css">
/* base variables */

/* Edit the CSS properties in this file to create a custom
   Distill theme. Only edit values in the right column
   for each row; values shown are the CSS defaults.
   To return any property to the default,
   you may set its value to: unset
   All rows must end with a semi-colon.                      */

/* Optional: embed custom fonts here with `@import`          */
/* This must remain at the top of this file.                 */

@import url('https://fonts.googleapis.com/css2?family=Roboto+Mono');
@import url('https://fonts.googleapis.com/css2?family=Roboto+Condensed');
@import url('https://fonts.googleapis.com/css2?family=Oswald:wght@200;400');
@import url('https://fonts.googleapis.com/css2?family=Fira+Code');


html {
  /*-- Main font sizes --*/
  --title-size:      50px;
  --body-size:       1.06rem;
  --code-size:       14px;
  --aside-size:      12px;
  --fig-cap-size:    13px;
  /*-- Main font colors --*/
  --title-color:     #000000;
  --header-color:    rgba(0, 0, 0, 0.8);
  --body-color:      rgba(0, 0, 0, 0.8);
  --aside-color:     rgba(0, 0, 0, 0.6);
  --fig-cap-color:   rgba(0, 0, 0, 0.6);
  /*-- Specify custom fonts ~~~ must be imported above   --*/
  --heading-font:    'Oswald', sans-serif;
  --mono-font:       'Roboto Mono', monospace;
  --body-font:       'Roboto Condensed', sans-serif;
  --navbar-font:     'Oswald', sans-serif;
  --code-font:       'Fira Code', monospace;
}

/*-- ARTICLE METADATA --*/
d-byline {
  --heading-size:    0.6rem;
  --heading-color:   rgba(0, 0, 0, 0.5);
  --body-size:       0.8rem;
  --body-color:      rgba(0, 0, 0, 0.8);
}

/*-- ARTICLE TABLE OF CONTENTS --*/
.d-contents {
  --heading-size:    18px;
  --contents-size:   13px;
}

/*-- ARTICLE APPENDIX --*/
d-appendix {
  --heading-size:    15px;
  --heading-color:   rgba(0, 0, 0, 0.65);
  --text-size:       0.8em;
  --text-color:      rgba(0, 0, 0, 0.5);
  --bkgd-color:      #f2f4f8;
}

/*-- WEBSITE HEADER + FOOTER --*/
/* These properties only apply to Distill sites and blogs  */

.distill-site-header {
  --title-size:       18px;
  --text-color:       rgba(255, 255, 255, 0.8);
  --text-size:        18px;
  --hover-color:      white;
  --bkgd-color:       #394B6A;
}

.distill-site-footer {
  --text-color:       rgba(255, 255, 255, 0.8);
  --text-size:        12px;
  --hover-color:      white;
  --bkgd-color:       #394B6A;
}

/*-- Additional custom styles --*/
/* Add any additional CSS rules below                      */

/*-- Code --*/
code, pre {
    font-family: "Fira+Code", "Roboto Mono", "Source Code Pro", "Lucida Console",
    Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
}</style>
<style type="text/css">
/* base style */

/* FONT FAMILIES */

:root {
  --heading-default: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", Arial, sans-serif;
  --mono-default: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
  --body-default: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", Arial, sans-serif;
}

body,
.posts-list .post-preview p,
.posts-list .description p {
  font-family: var(--body-font), var(--body-default);
}

h1, h2, h3, h4, h5, h6,
.posts-list .post-preview h2,
.posts-list .description h2 {
  font-family: var(--heading-font), var(--heading-default);
}

d-article div.sourceCode code,
d-article pre code {
  font-family: var(--mono-font), var(--mono-default);
}


/*-- TITLE --*/
d-title h1,
.posts-list > h1 {
  color: var(--title-color, black);
}

d-title h1 {
  font-size: var(--title-size, 50px);
}

/*-- HEADERS --*/
d-article h1,
d-article h2,
d-article h3,
d-article h4,
d-article h5,
d-article h6 {
  color: var(--header-color, rgba(0, 0, 0, 0.8));
}

/*-- BODY --*/
d-article > p,  /* only text inside of <p> tags */
d-article > ul, /* lists */
d-article > ol {
  color: var(--body-color, rgba(0, 0, 0, 0.8));
  font-size: var(--body-size, 1.06rem);
}


/*-- CODE --*/
d-article div.sourceCode code,
d-article pre code {
  font-size: var(--code-size, 14px);
}

/*-- ASIDE --*/
d-article aside {
  font-size: var(--aside-size, 12px);
  color: var(--aside-color, rgba(0, 0, 0, 0.6));
}

/*-- FIGURE CAPTIONS --*/
figure .caption,
figure figcaption,
.figure .caption {
  font-size: var(--fig-cap-size, 13px);
  color: var(--fig-cap-color, rgba(0, 0, 0, 0.6));
}

/*-- METADATA --*/
d-byline h3 {
  font-size: var(--heading-size, 0.6rem);
  color: var(--heading-color, rgba(0, 0, 0, 0.5));
}

d-byline {
  font-size: var(--body-size, 0.8rem);
  color: var(--body-color, rgba(0, 0, 0, 0.8));
}

d-byline a,
d-article d-byline a {
  color: var(--body-color, rgba(0, 0, 0, 0.8));
}

/*-- TABLE OF CONTENTS --*/
.d-contents nav h3 {
  font-size: var(--heading-size, 18px);
}

.d-contents nav a {
  font-size: var(--contents-size, 13px);
}

/*-- APPENDIX --*/
d-appendix h3 {
  font-size: var(--heading-size, 15px);
  color: var(--heading-color, rgba(0, 0, 0, 0.65));
}

d-appendix {
  font-size: var(--text-size, 0.8em);
  color: var(--text-color, rgba(0, 0, 0, 0.5));
}

d-appendix d-footnote-list a.footnote-backlink {
  color: var(--text-color, rgba(0, 0, 0, 0.5));
}

/*-- WEBSITE HEADER + FOOTER --*/
.distill-site-header .title {
  font-size: var(--title-size, 18px);
  font-family: var(--navbar-font), var(--heading-default);
}

.distill-site-header a,
.nav-dropdown .nav-dropbtn {
  font-family: var(--navbar-font), var(--heading-default);
}

.nav-dropdown .nav-dropbtn {
  color: var(--text-color, rgba(255, 255, 255, 0.8));
  font-size: var(--text-size, 15px);
}

.distill-site-header a:hover,
.nav-dropdown:hover .nav-dropbtn {
  color: var(--hover-color, white);
}

.distill-site-header {
  font-size: var(--text-size, 15px);
  color: var(--text-color, rgba(255, 255, 255, 0.8));
  background-color: var(--bkgd-color, #0F2E3D);
}

.distill-site-footer {
  font-size: var(--text-size, 15px);
  color: var(--text-color, rgba(255, 255, 255, 0.8));
  background-color: var(--bkgd-color, #0F2E3D);
}

.distill-site-footer a:hover {
  color: var(--hover-color, white);
}</style>
<!--/radix_placeholder_distill-->
  <script src="../../site_libs/jquery-1.11.3/jquery.min.js"></script>
  <script src="../../site_libs/bowser-1.9.3/bowser.min.js"></script>
  <script src="../../site_libs/webcomponents-2.0.0/webcomponents.js"></script>
  <script src="../../site_libs/distill-2.2.21/template.v2.js"></script>
  <!--radix_placeholder_site_in_header-->
<script>
  document.addEventListener("DOMContentLoaded", function () {
    if (!/posts/.test(location.pathname)) {
      return;
    }

    var script = document.createElement("script");
    script.src = "https://utteranc.es/client.js";
    script.setAttribute("repo", "taraskaduk/taraskaduk-distill");
    script.setAttribute("issue-term", "og:title");
    script.setAttribute("crossorigin", "anonymous");
    script.setAttribute("label", "comment_thread");

    /* wait for article to load, append script to article element */
    var observer = new MutationObserver(function (mutations, observer) {
      var article = document.querySelector("d-appendix");
      if (article) {
        observer.disconnect();
        /* HACK: article scroll */
        article.setAttribute("style", "overflow-y: hidden");
        article.appendChild(script);
      }
    });

    observer.observe(document.body, { childList: true });
  });
</script>

<!--/radix_placeholder_site_in_header-->


</head>

<body>

<!--radix_placeholder_front_matter-->

<script id="distill-front-matter" type="text/json">
{"title":"Analyze and visualize your iPhone's Health app data in R","description":"Learn to import, analyze and visualize your Health app data in R","authors":[{"author":"Taras Kaduk","authorURL":"https://taraskaduk.com","affiliation":"&nbsp;","affiliationURL":"#","orcidID":""}],"publishedDate":"2019-03-23T00:00:00.000+01:00","citationText":"Kaduk, 2019"}
</script>

<!--/radix_placeholder_front_matter-->
<!--radix_placeholder_navigation_before_body-->
<header class="header header--fixed" role="banner">
<nav class="distill-site-nav distill-site-header">
<div class="nav-left">
<a class="logo" href="https://taraskaduk.com">
<img src="../../static/logo.png" alt="Logo"/>
</a>
<a href="../../index.html" class="title">Edward Hillenaar</a>
<input id="distill-search" class="nav-search hidden" type="text" placeholder="Search..."/>
</div>
<div class="nav-right">
<a href="../../index.html">Home</a>
<a href="../../about.html">About</a>
<a href="../../geo.html">Posts</a>
<a href="../../talks.html">Talks</a>
<a href="../../index.xml">
<i class="fa fa-rss" aria-hidden="true"></i>
</a>
<a href="https://github.com/EdwardHill15">
<i class="fa fa-github" aria-hidden="true"></i>
</a>
<a href="javascript:void(0);" class="nav-toggle">&#9776;</a>
</div>
</nav>
</header>
<!--/radix_placeholder_navigation_before_body-->
<!--radix_placeholder_site_before_body-->
<!--/radix_placeholder_site_before_body-->

<div class="d-title">
<h1>Analyze and visualize your iPhone’s Health app data in R</h1>
<p>Learn to import, analyze and visualize your Health app data in R</p>
</div>

<div class="d-byline">
  Taras Kaduk <a href="https://taraskaduk.com" class="uri">https://taraskaduk.com</a> 
  
<br/>2019-03-23
</div>

<div class="d-article">
<h2 id="introduction">Introduction</h2>
<p>I am convinced that many data scientists and data analysts acquire a peculiar reflex. Any time they suspect (consciously or subconsciously) that somewhere data is being collected, they develop an irresistible itch to analyze that data, oftentimes not even knowing where the data is!</p>
<p><img src="cheese.gif" /></p>
<p>After purchasing my first iPhone, I quickly realized that its Health app is capable of storing lots of data points. I looked at and analyzed some weight and steps data from my Android phone in the past, but this seemed like a whole new level.</p>
<p>I Googled around and found <a href="http://www.ryanpraski.com/apple-health-data-how-to-export-analyze-visualize-guide/">this post</a> from <a href="https://twitter.com/ryanpraski">ryanpraski</a>. The code was reproducible enough, and I ran it on my side, made a few changes and kind of left it.</p>
<p>Fast forward about 2 years, I got an Apple Watch, and got a lot more data points into my Health app. I also got a bit more serious about my workouts and my wellness, and started to rely on Health app data a lot. At one point, I even built out a small <code>patchwork</code> dashboard that helped me during my “bulking” and “cutting” phases: I tracked my weight, basal and active energy, calorie intake, daily amount of protein intake etc.</p>
<p>Long story short, I accumulated enough charts and ideas to put into a blog post and share them all with the world. And so, without further ado…</p>
<h2 id="get-the-data">Get the data</h2>
<p>Getting the data out of Health app is pretty easy. From Apple Health, you can export it anywhere. I save it right away into the Files, which instantly appears in my iCloud and is accessible from my Mac.</p>
<p><img src="1.jpg" /></p>
<p>Your mileage may vary based on the path you chose to get the files. You could save it on the cloud, and then access via a web link, for instance. I find the iCloud storage synced up to your Mac being the most convenient solution. Another thing you can do is to use a Shortcut to get the Health data in a different way. For example, there is <a href="https://www.icloud.com/shortcuts/db56d325085d4582aacc0e1b4bccf326">this shortcut here</a>, but you can write your own.</p>
<p>Anyway, back to our zip export. Now that the zip archive is on my Mac, you can break out an R session and start prodding.</p>
<h2 id="import">Import</h2>
<p>Before I forget, a few packages you’ll need to replicate the analysis/charts are:</p>
<pre class="r"><code>
library(XML)
library(tidyverse)
library(lubridate)
library(scales)
library(ggthemes)</code></pre>
<p>The path to a folder on iCloud when synced up with the cloud looks funny. You’re better off creating an RStudio project and landing your archive right in that folder. But just FYI, if you sync your Documents folder to iCloud and later want to reach the local files, the path would look like this:</p>
<pre class="r"><code>
path &lt;- &#39;~/Library/Mobile\ Documents/com~apple~CloudDocs/Documents&#39;</code></pre>
<p>Anyhow, get that zip archive and unzip it</p>
<pre class="r"><code>
zip &lt;- paste(path, &#39;export.zip&#39;, sep = &#39;/&#39;)
unzip(zip, exdir = path)
Sys.sleep(3) # pause for 3 seconds to let your computer unzip it.</code></pre>
<p>Now that we unzipped the archive, we can work with the actual data. BTW, the contents of your unzipped folder will look something like this:</p>
<pre class="r"><code>
&gt; list.files(paste0(path,&#39;/apple_health_export&#39;))
[1] &quot;clinical-records&quot;   &quot;electrocardiograms&quot; &quot;export_cda.xml&quot;     &quot;export.xml&quot;</code></pre>
<ul>
<li><code>export.xml</code> is the data we’ll be using primarily</li>
<li>I’m not entirely clear on what <code>export_cda.xml</code> is: it seems to contain the data similar to <code>export.xml</code>, but I haven’t had much luck completely parsing it. I understand CDA stands for <a href="http://www.hl7.org/implement/standards/product_brief.cfm?product_id=7">Clinical Document Architecture</a> and is a special format to exchange these kinds of data.</li>
<li><code>electrocardiograms</code> is a folder where your Apple Watch ⌚️ ECGs are stored in csv format</li>
<li><code>clinical-records</code> is where external clinical results land (if you connected a clinic to your Apple Health did some lab work)</li>
</ul>
<p>But we’ll focus solely on <code>export.xml</code> file</p>
<p>First create an xml object containing all of the data as a starting point</p>
<pre class="r"><code>
xml &lt;- xmlParse(paste0(path, &#39;/apple_health_export/export.xml&#39;))
summary(xml)</code></pre>
<p>Your mileage may vary based on the amount of data you store in Apple Health, and the amount of Apple devices that use Apple Health (iPhone alone or iPhone + Apple Watch⌚). A brief rundown is the following:</p>
<ul>
<li><strong>Record</strong> is the main place where the data is stored. Weight, height, blood pressure, steps, nutrition data, heart rate - all stored here</li>
<li><strong>ActivitySummary</strong> is your Apple Watch daily Activity stats: Move, Exercise, Stand data</li>
<li><strong>Workout</strong> is your Apple Watch workout activity per workout logged</li>
<li><strong>Location</strong> is your location logged during your Apple Watch workouts (useful for runs/hikes)</li>
<li><strong>InstantaneousBeatsPerMinute</strong> is exactly that: instantaneous heart rate when measured by AppleWatch</li>
<li><strong>ExportDate</strong> is useful to validate what data are you looking at.</li>
</ul>
<p>The rest is either some matadata or something that I haven’t found much use for (yet) You can get the data into a clean nice data frame from each attribute with a simple function here:</p>
<pre class="r"><code>
df_record &lt;-   XML:::xmlAttrsToDataFrame(xml[&quot;//Record&quot;])
df_activity &lt;- XML:::xmlAttrsToDataFrame(xml[&quot;//ActivitySummary&quot;])
df_workout &lt;-  XML:::xmlAttrsToDataFrame(xml[&quot;//Workout&quot;])
df_clinical &lt;- XML:::xmlAttrsToDataFrame(xml[&quot;//ClinicalRecord&quot;])
df_location &lt;- XML:::xmlAttrsToDataFrame(xml[&quot;//Location&quot;]) %&gt;% 
  mutate(latitude = as.numeric(as.character(latitude)),
         longitude = as.numeric(as.character(longitude)))</code></pre>
<p>Here are the <code>str()</code> calls to these data frames:</p>
<h4 id="record">Record</h4>
<pre class="r"><code>
&#39;data.frame&#39;:   527744 obs. of  9 variables:
 $ type         : Factor w/ 34 levels &quot;HKQuantityTypeIdentifierActiveEnergyBurned&quot;,..: 4 4 28 7 7 7 7 7 7 7 ...
 $ sourceName   : Factor w/ 8 levels &quot;Health&quot;,&quot;MyFitnessPal&quot;,..: 1 1 1 1 1 1 1 1 1 1 ...
 $ sourceVersion: Factor w/ 40 levels &quot;1&quot;,&quot;10.2.1&quot;,&quot;10.3.1&quot;,..: 8 21 2 3 3 3 3 3 3 3 ...
 $ unit         : Factor w/ 14 levels &quot;count&quot;,&quot;count/min&quot;,..: 8 8 3 6 6 6 6 6 6 6 ...
 $ creationDate : Factor w/ 190384 levels &quot;2017-03-25 18:51:22 -0400&quot;,..: 3313 23291 54 226 239 256 275 342 356 382 ...
 $ startDate    : Factor w/ 340829 levels &quot;2017-03-25 18:39:37 -0400&quot;,..: 9329 31933 159 634 672 711 768 967 999 1057 ...
 $ endDate      : Factor w/ 341207 levels &quot;2017-03-25 18:46:21 -0400&quot;,..: 9326 31926 159 634 671 711 768 967 999 1057 ...
 $ value        : Factor w/ 77589 levels &quot;0&quot;,&quot;0.000102795&quot;,..: 77165 77109 76024 65909 65912 65908 65563 65918 65918 65910 ...
 $ device       : Factor w/ 96622 levels &quot;&lt;&lt;HKDevice: 0x282d00000&gt;, name:Apple Watch, manufacturer:Apple, model:Watch, hardware:Watch4,1, software:5.0.1&gt;&quot;,..: NA NA NA NA NA NA NA NA NA NA ...</code></pre>
<h4 id="activity">Activity</h4>
<pre class="r"><code>
&#39;data.frame&#39;:   130 obs. of  8 variables:
 $ dateComponents        : Factor w/ 130 levels &quot;2018-11-04&quot;,&quot;2018-11-05&quot;,..: 1 2 3 4 5 6 7 8 9 10 ...
 $ activeEnergyBurned    : Factor w/ 128 levels &quot;0&quot;,&quot;1017.62&quot;,..: 1 1 1 48 19 96 99 30 110 31 ...
 $ activeEnergyBurnedGoal: Factor w/ 4 levels &quot;0&quot;,&quot;760&quot;,&quot;770&quot;,..: 1 1 1 2 2 2 2 2 2 2 ...
 $ activeEnergyBurnedUnit: Factor w/ 1 level &quot;kcal&quot;: 1 1 1 1 1 1 1 1 1 1 ...
 $ appleExerciseTime     : Factor w/ 75 levels &quot;0&quot;,&quot;1&quot;,&quot;10&quot;,&quot;102&quot;,..: 1 1 1 22 73 44 40 7 38 4 ...
 $ appleExerciseTimeGoal : Factor w/ 1 level &quot;30&quot;: 1 1 1 1 1 1 1 1 1 1 ...
 $ appleStandHours       : Factor w/ 12 levels &quot;0&quot;,&quot;10&quot;,&quot;11&quot;,..: 1 1 1 3 8 7 8 7 6 7 ...
 $ appleStandHoursGoal   : Factor w/ 1 level &quot;12&quot;: 1 1 1 1 1 1 1 1 1 1 ...</code></pre>
<h4 id="workout">Workout</h4>
<pre class="r"><code>
&#39;data.frame&#39;:   146 obs. of  13 variables:
 $ workoutActivityType  : Factor w/ 8 levels &quot;HKWorkoutActivityTypeHiking&quot;,..: 8 8 2 8 8 8 8 8 7 8 ...
 $ duration             : Factor w/ 146 levels &quot;1.413170067469279&quot;,..: 50 54 99 32 4 35 66 59 116 67 ...
 $ durationUnit         : Factor w/ 1 level &quot;min&quot;: 1 1 1 1 1 1 1 1 1 1 ...
 $ totalDistance        : Factor w/ 80 levels &quot;0&quot;,&quot;0.1136363666704027&quot;,..: 57 63 1 47 6 14 61 66 1 7 ...
 $ totalDistanceUnit    : Factor w/ 1 level &quot;mi&quot;: 1 1 1 1 1 1 1 1 1 1 ...
 $ totalEnergyBurned    : Factor w/ 146 levels &quot;10.9099860589808&quot;,..: 101 141 42 74 64 65 4 8 78 131 ...
 $ totalEnergyBurnedUnit: Factor w/ 1 level &quot;kcal&quot;: 1 1 1 1 1 1 1 1 1 1 ...
 $ sourceName           : Factor w/ 2 levels &quot;StrongLifts&quot;,..: 2 2 2 2 2 2 2 2 2 2 ...
 $ sourceVersion        : Factor w/ 5 levels &quot;1&quot;,&quot;5.0.1&quot;,&quot;5.1.1&quot;,..: 2 2 2 2 2 2 2 2 2 3 ...
 $ device               : Factor w/ 140 levels &quot;&lt;&lt;HKDevice: 0x282d440a0&gt;, name:Apple Watch, manufacturer:Apple, model:Watch, hardware:Watch4,1, software:5.1.1&gt;&quot;
 $ creationDate         : Factor w/ 146 levels &quot;2018-11-13 09:19:23 -0400&quot;,..: 1 2 3 4 5 6 7 8 9 10 ...
 $ startDate            : Factor w/ 146 levels &quot;2018-11-13 09:04:43 -0400&quot;,..: 1 2 3 4 5 6 7 8 9 10 ...
 $ endDate              : Factor w/ 146 levels &quot;2018-11-13 09:19:23 -0400&quot;,..: 1 2 3 4 5 6 7 8 9 10 ...</code></pre>
<h4 id="clinical">Clinical</h4>
<pre class="r"><code>
data.frame&#39;:    17 obs. of  7 variables:
 $ type            : Factor w/ 3 levels &quot;DiagnosticReport&quot;,..: 3 1 1 1 1 1 1 1 1 2 ...
 $ identifier      : Factor w/ 17 levels &quot;bqRS...dsJBAkJw&quot;,..: 5 16 13 4 17 2 7 12 6 11 ...
 $ sourceName      : Factor w/ 1 level &quot;Quest Diagnostics&quot;
 $ sourceURL       : Factor w/ 17 levels &quot;https://api.questdiagnostics.com/resource-server/fhir/DiagnosticRepor&quot;,..: 
 $ fhirVersion     : Factor w/ 1 level &quot;1.0.2&quot;: 1 1 1 1 1 1 1 1 1 1 ...
 $ receivedDate    : Factor w/ 2 levels &quot;2018-12-09 11:50:24 -0400&quot;,..: 1 2 2 2 2 2 2 2 2 2 ...
 $ resourceFilePath: Factor w/ 17 levels &quot;/clinical-records/Dia...tiReport-3...2709.json&quot;,..: 17 4 5 3 6 2 1 8 7 14 ...</code></pre>
<h4 id="location">Location</h4>
<pre class="r"><code>
&#39;data.frame&#39;:   58017 obs. of  8 variables:
 $ date              : Factor w/ 57899 levels &quot;2018-11-13 09:14:50 -0400&quot;,..: 1 2 3 4 5 6 7 8 9 10 ...
 $ latitude          : num  30.3 30.3 30.3 30.3 30.3 ...
 $ longitude         : num  -81.7 -81.7 -81.7 -81.7 -81.7 ...
 $ altitude          : Factor w/ 47107 levels &quot;-0.0223591&quot;,&quot;-0.0238451&quot;,..: 39102 38801 38480 38045 37539 36906 36167 35364 34635 33990 ...
 $ horizontalAccuracy: Factor w/ 32278 levels &quot;0.785208&quot;,&quot;0.785209&quot;,..: 18259 17319 16544 14808 11859 10555 9507 8498 7891 7884 ...
 $ verticalAccuracy  : Factor w/ 32170 levels &quot;0.637318&quot;,&quot;0.637338&quot;,..: 23883 21283 18904 17946 16896 12473 10202 8930 7976 7775 ...
 $ course            : Factor w/ 29914 levels &quot;-1&quot;,&quot;0.000919214&quot;,..: 27796 27598 27534 29183 27827 27505 26221 27761 27833 27836 ...
 $ speed             : Factor w/ 47316 levels &quot;-1&quot;,&quot;0&quot;,&quot;0.000127598&quot;,..: 21577 21574 21551 21446 21229 20885 20389 19726 18890 17951 ...</code></pre>
<p>Well, this is pretty much it. From here, you can let you imagination run wild. The stuff you’ll be able to do will depend on how much data you store in Apple Health and what’s the use case you have.</p>
<p>Below, I’ll just provide a few brief examples of what I did with the data (erasing numeric or other identifying values where necessary).</p>
<h2 id="examples">Examples</h2>
<h3 id="record-data-frame">Record data frame</h3>
<pre class="r"><code>
 df &lt;- df_record %&gt;%
  mutate(device = gsub(&quot;.*(name:)|,.*&quot;, &quot;&quot;,device),
         value = as.numeric(as.character(value)),
         endDate = ymd_hms(endDate,tz=&quot;America/New_York&quot;),
         date = date(endDate),
         year = year(endDate),
         month = month(endDate),
         day = day(endDate),
         yday = yday(endDate),
         wday = wday(endDate),
         hour = hour(endDate),
         minute = minute(endDate),
         type = str_remove(type, &quot;HKQuantityTypeIdentifier&quot;)
         )</code></pre>
<p>See what kind of data is stored:</p>
<pre class="r"><code>
df %&gt;% select(type) %&gt;% distinct()</code></pre>
<pre class="r"><code>
                        type
1               BloodGlucose
2                     Height
3                   BodyMass
4                  HeartRate
5      BloodPressureSystolic
6     BloodPressureDiastolic
7            RespiratoryRate
8                  StepCount
9     DistanceWalkingRunning
10         BasalEnergyBurned
11        ActiveEnergyBurned
12            FlightsClimbed
13           DietaryFatTotal
14 DietaryFatPolyunsaturated
15 DietaryFatMonounsaturated
16       DietaryFatSaturated
17        DietaryCholesterol
18             DietarySodium
19      DietaryCarbohydrates
20              DietaryFiber
21              DietarySugar
22     DietaryEnergyConsumed
23            DietaryProtein
24           DietaryVitaminC
25            DietaryCalcium
26               DietaryIron
27          DietaryPotassium
28         AppleExerciseTime
29          DistanceSwimming
30       SwimmingStrokeCount
31          RestingHeartRate
32                    VO2Max
33   WalkingHeartRateAverage
34  HeartRateVariabilitySDNN</code></pre>
<h4 id="weight-data">Weight data</h4>
<p>First of all, if you use iPhone, there is no Earthly reason for you to log your weight in Google Forms or some other spreadsheet. Putting the number into Health is super easy, and I like storing things in one place (versus a bunch of orphan spreadsheets). And with the acquisition of Workflow and the renaming it into Shortcuts, it’s even easier:</p>
<p><img src="weight.gif" /></p>
<p>I’ve been tracking my daily weight since my Android times, and tried many approaches. Apple Health + Shortcuts is by far the most efficient and reliable.</p>
<p><em>(And yes, you can get or write other Shortcuts to enter other data besides your weight into the Health app)</em></p>
<p>Anyway, here are a few ways to visualize your data. A vanilla weight chart, for example:</p>
<pre class="r"><code>
df %&gt;%
  arrange(endDate) %&gt;% 
  filter(type == &#39;BodyMass&#39;) %&gt;% 
  # Had to reduce sourceName to these 2 sources to avoid double-counting
  # by other apps that use BodyMass and then store it back into Health
  filter(sourceName %in% c(&quot;Health&quot;, &quot;Shortcuts&quot;)) %&gt;% 
  
  ggplot(aes(x= date, y = value)) +
    geom_point(alpha = 0.3) +
    geom_smooth(span = 0.2, col = &quot;grey30&quot;, se = FALSE) +
    labs(title = &quot;Apple Health Weight Chart Sample&quot;,
         caption = &quot;@taraskaduk | taraskaduk.com&quot;) +
    theme(axis.text.y = element_blank()) # you shouldn&#39;t see these, lol</code></pre>
<p><img src="weight1.png" /></p>
<p>With a few additional calls to <code>geom_vline()</code> and <code>geom_line()</code> you can supercharge this chart and make it a part of a goal-tracking dashboard:</p>
<p><img src="weight2.png" /></p>
<h4 id="more-daily-grain-data">More daily grain data</h4>
<p>There many more charts you can build from this grain: your resting heart rate, walking heart rate, VO2Max, and anything else that can be summarized to a daily level. <img src="daily.png" /></p>
<h4 id="hourly-grain">Hourly grain</h4>
<p>Some data is fun to see on an hourly grain. For example, step count and heart rate, when summarized to an hourly level, shows some cool stuff:</p>
<pre class="r"><code>
df %&gt;%
  filter(type %in% c(&#39;HeartRate&#39;, &#39;StepCount&#39;)) %&gt;% 
  group_by(type, hour) %&gt;% 
  summarise(value = mean(value)) %&gt;% 
  ggplot(aes(x = hour, y = value, fill = value)) +
  geom_col() +
  scale_fill_continuous(low = &#39;grey70&#39;, high = &quot;#008FD5&quot;) +
  scale_x_continuous(
    breaks = c(0, 6, 12, 18),
    label = c(&quot;Midnight&quot;, &quot;6 AM&quot;, &quot;Midday&quot;, &quot;6 PM&quot;)
  ) +
  labs(title = &quot;Apple Health Data&quot;,
       subtitle = &quot;Hourly Data Sample&quot;,
       caption = &#39;@taraskaduk | taraskaduk.com&#39;) +
  facet_wrap(~ type)+
  guides(fill=FALSE)</code></pre>
<p><img src="hourly.png" /></p>
<p>As these two charts nicely reveal, I have a sedentary job, I walk to work and from work, and walk around during my break, I work out after work (hence a slightly higher step count around 6 PM + higher heart rate). Or, if we further break down the step count by day of the week, it will reveal that on weekend, I move a bit all the time, versus more concentrated activity on weekdays:</p>
<pre class="r"><code>
df %&gt;%
  filter(type == &#39;StepCount&#39;) %&gt;% 
  group_by(date,wday,hour) %&gt;% 
  summarize(steps=sum(value)) %&gt;% 
  group_by(hour,wday) %&gt;% 
  summarize(steps=sum(steps)) %&gt;% 
  arrange(desc(steps)) %&gt;%

  ggplot(aes(x=hour, y=wday,  fill=steps)) + 
    geom_tile(col = &#39;grey40&#39;) + 
    scale_fill_continuous(labels = scales::comma, low = &#39;grey95&#39;, high = &#39;#008FD5&#39;) +
    theme(panel.grid.major = element_blank()) +
    scale_x_continuous(
      breaks = c(0, 6, 12, 18),
      label = c(&quot;Midnight&quot;, &quot;6 AM&quot;, &quot;Midday&quot;, &quot;6 PM&quot;)
    ) +
    scale_y_reverse(
      breaks = c(1,2,3,4,5,6,7),
      label = c(&quot;Sunday&quot;, &quot;Monday&quot;, &quot;Tuesday&quot;, &quot;Wednesday&quot;, &quot;Thursday&quot;, &quot;Friday&quot;, &quot;Saturday&quot;)
    ) +
    labs(title = &quot;Weekly Step Count Heatmap&quot;,
         caption = &#39;@taraskaduk | taraskaduk.com&#39;) +
    guides(fill=FALSE)+
    coord_equal()</code></pre>
<p><img src="heatmap1.png" /></p>
<p>Same can be done with a “days X months” grid, or anything else - you name it.</p>
<h4 id="calorie-deficit-and-surplus">Calorie deficit and surplus</h4>
<p>If you’re tracking your meals in an app like MyFitnessPal, as well as having an Apple Watch, you can figure out your caloric surplus or deficit based on the data from your nutrition and your Apple Watch’s basal and active energy readings. The next chart goes a little something like this:</p>
<pre class="r"><code>
energy &lt;- df %&gt;%
  filter(endDate &gt;= &#39;2018/11/24&#39; &amp; 
           date &lt; &#39;2018/12/30&#39; &amp; 
           type %in% c(&#39;BasalEnergyBurned&#39;, &#39;ActiveEnergyBurned&#39;, &#39;DietaryEnergyConsumed&#39;)) %&gt;%
  select(date, type, value) %&gt;% 
  group_by(date, type) %&gt;% 
  summarise(value = sum(value)) %&gt;% 
  ungroup()

ggplot() +
  geom_col(data = energy %&gt;% 
             filter(type != &quot;DietaryEnergyConsumed&quot;),
             aes(x= date, y = value, fill = type)) +
  scale_fill_manual(values = c(&quot;BasalEnergyBurned&quot; = &quot;#3182bd&quot;, 
                               &quot;ActiveEnergyBurned&quot; = &quot;#9ecae1&quot;, 
                               &quot;DietaryEnergyConsumed&quot; = &quot;grey30&quot;)) +
  geom_col(data = energy %&gt;% 
             filter(type == &quot;DietaryEnergyConsumed&quot;), 
             aes(x= date, y = value, fill = type),  width = 0.7, alpha = 0.6) +
  labs(title = &quot;Calories Consumed &amp; Burned&quot;,
       caption = &#39;@taraskaduk | taraskaduk.com&#39;)

ggsave(&#39;energy1.png&#39;, width = 8, height = 6, units = &quot;in&quot;)</code></pre>
<p><img src="energy1.png" /></p>
<p>You can also calculate given deficit/surplus by a bit of data wrangling:</p>
<pre class="r"><code>
energy_spread &lt;- energy %&gt;% 
  spread(type, value) %&gt;% 
  mutate(EnergyBurned = ActiveEnergyBurned + BasalEnergyBurned,
         EnergyConsumed = DietaryEnergyConsumed,
         EnergyDeficit = EnergyBurned - EnergyConsumed,
         EnergyDeficitPct = EnergyDeficit / EnergyBurned,
         EnergyDeficitCat = if_else(EnergyDeficit &gt; 0, &#39;Deficit&#39;, &#39;Surplus&#39;))

energy_spread %&gt;% 
  ggplot(aes(x= date, y = EnergyDeficitPct, fill = EnergyDeficitCat)) +
  geom_col() +
  scale_fill_manual(values = c(&quot;#1a9641&quot;, &quot;#ca0020&quot;))+
  labs(title = &quot;Calorie deficit and surplus&quot;,
       caption = &#39;@taraskaduk | taraskaduk.com&#39;)</code></pre>
<p>(oh, hey, look, I overate a lot on Christmas!)</p>
<div class="layout-chunk" data-layout="l-body">
<p><img src="energy2.png" width="1200" data-distill-preview=1 /></p>
</div>
<h4 id="other-dietary-data">Other dietary data</h4>
<p>Speaking of nutrition data, you can track many various macros and micros directly from Apple Health if your nutrition tracking app is connected to it.</p>
<pre class="r"><code>
df %&gt;%
  filter(type %in% c(&#39;DietaryFatSaturated&#39;, &#39;DietaryProtein&#39;, &#39;DietaryCholesterol&#39;, &#39;DietaryPotassium&#39;)) %&gt;% 
  mutate(type = str_remove(type, &quot;Dietary&quot;)) %&gt;% 
  group_by(type, date) %&gt;% 
  summarise(value = sum(value)) %&gt;% 
  
  ggplot(aes(x= date, y = value)) +
    geom_smooth(span = 0.7, alpha = 0.2, col = &quot;grey30&quot;, se = FALSE) +
    geom_point(alpha = 0.5) +
    facet_wrap(~type, scales=&quot;free&quot;) +
    labs(title = &quot;Nutrition Micros and Macros to Track&quot;,
         caption = &#39;@taraskaduk | taraskaduk.com&#39;)</code></pre>
<p><img src="dietary.png" /></p>
<p>For example, you could plot your protein intake against your body weight and then visualize the percentage, if you’re working out and need to ensure a specific amount of protein intake every day.</p>
<h4 id="other-external-data-blood-pressure">Other external data: blood pressure</h4>
<p>You can get many other things out of Apple Health data dump. For example, I use an OMRON blood pressure monitor, and it syncs the data to my Apple Health (or, I could enter the readings manually upon my health checkups if I didn’t have a monitor at home). I later can extract this BP data and visualize it:</p>
<pre class="r"><code>
blood_pressure &lt;- df %&gt;%
  filter(type %in% c(&#39;BloodPressureSystolic&#39;, &quot;BloodPressureDiastolic&quot;)) %&gt;% 
  mutate(type = str_remove(type, &quot;BloodPressure&quot;)) %&gt;% 
  select(value, type, date:hour) %&gt;% 
  group_by_at(vars(-value)) %&gt;% 
  summarise(value = mean(value)) %&gt;% 
  mutate(morning = if_else(hour &gt;=5 &amp; hour &lt;= 8, TRUE, FALSE),
         stage = factor(if_else(type == &quot;Systolic&quot;,
                              case_when(value &lt;  xxx ~ &quot;Normal&quot;,
                                        value &lt;  xxx ~ &quot;Elevated&quot;,
                                        value &lt;  xxx ~ &quot;Hypertension 1&quot;,
                                        value &lt;  xxx ~ &quot;Hypertension 2&quot;,
                                        value &gt;= xxx ~ &quot;Hypertensive Crisis&quot;,
                                        TRUE ~ NA_character_),
                              case_when(value &lt;  xxx ~ &quot;Normal&quot;,
                                        value &lt;  xxx ~ &quot;Elevated&quot;,
                                        value &lt;  xxx ~ &quot;Hypertension 1&quot;,
                                        value &lt;  xxx ~ &quot;Hypertension 2&quot;,
                                        value &gt;= xxx ~ &quot;Hypertensive Crisis&quot;,
                                        TRUE ~ NA_character_)),
                      levels = c(&quot;Normal&quot;,
                                 &quot;Elevated&quot;,
                                 &quot;Hypertension 1&quot;,
                                 &quot;Hypertension 2&quot;,
                                 &quot;Hypertensive Crisis&quot;)))


blood_pressure  %&gt;% 
  filter(morning == TRUE) %&gt;% 
  ggplot(aes(x= date, y = value, group = type, col = stage)) +
  geom_smooth(span = 0.7, alpha = 0.4, col = &quot;grey40&quot;, se = FALSE) +
  geom_point(size = 3, alpha = 0.7) + 
  scale_color_brewer(palette = &quot;RdYlGn&quot;, direction = -1) +
  labs(title = &quot;Blood pressure&quot;,
       subtitle = &quot;Systolic and Diastolic&quot;,
       caption = &#39;@taraskaduk | taraskaduk.com&#39;)</code></pre>
<p><img src="bp.png" /></p>
<h3 id="activity-data-frame">Activity data frame</h3>
<p>Another dataset in Apple Health is your Apple Watch’s activity: Move, Exercise and Stand rings that you have daily. The grain is daily, and there is a reading and a goal for each metric (kind of redundant for Stand and Exercise, as these goals don’t change, but I guess it’s easier that way). Looking at <code>str(df_activity)</code>:</p>
<pre class="r"><code>
 &#39;data.frame&#39;:  130 obs. of  8 variables:
 $ dateComponents        : Factor w/ 130 levels &quot;2018-11-04&quot;,&quot;2018-11-05&quot;,..: 1 2 3 4 5 6 7 8 9 10 ...
 $ activeEnergyBurned    : Factor w/ 128 levels &quot;0&quot;,&quot;1017.62&quot;,..: 1 1 1 48 19 96 99 30 110 31 ...
 $ activeEnergyBurnedGoal: Factor w/ 4 levels &quot;0&quot;,&quot;760&quot;,&quot;770&quot;,..: 1 1 1 2 2 2 2 2 2 2 ...
 $ activeEnergyBurnedUnit: Factor w/ 1 level &quot;kcal&quot;: 1 1 1 1 1 1 1 1 1 1 ...
 $ appleExerciseTime     : Factor w/ 75 levels &quot;0&quot;,&quot;1&quot;,&quot;10&quot;,&quot;102&quot;,..: 1 1 1 22 73 44 40 7 38 4 ...
 $ appleExerciseTimeGoal : Factor w/ 1 level &quot;30&quot;: 1 1 1 1 1 1 1 1 1 1 ...
 $ appleStandHours       : Factor w/ 12 levels &quot;0&quot;,&quot;10&quot;,&quot;11&quot;,..: 1 1 1 3 8 7 8 7 6 7 ...
 $ appleStandHoursGoal   : Factor w/ 1 level &quot;12&quot;: 1 1 1 1 1 1 1 1 1 1 ...</code></pre>
<p>With a bit of data wrangling, you can do lots of cool stuff. I maxed out the acceptable amount of vanilla charts in this post, so let me do another tile chart again. This will require a bit of R code though, but stay with me here.</p>
<pre class="r"><code>
#Some data clean up  and renaming here
df_activity_tidy &lt;- df_activity %&gt;% 
  select(-activeEnergyBurnedUnit) %&gt;% 
  mutate_all(as.character) %&gt;% 
  mutate(date = as.Date(dateComponents)) %&gt;% 
  filter(date &gt;= &quot;2018-11-13&quot;) %&gt;% 
  select(-dateComponents) %&gt;% 
  mutate_if(is.character, as.numeric) %&gt;% 
  rename(move = activeEnergyBurned,
         exercise = appleExerciseTime,
         stand = appleStandHours,
         move_goal = activeEnergyBurnedGoal,
         exercise_goal = appleExerciseTimeGoal,
         stand_goal = appleStandHoursGoal) %&gt;% 
#Now, create 2 new metrics: percent of goal and a &quot;Yes/No&quot; flag.
  mutate(move_pct = move/move_goal,
         exercise_pct = exercise/exercise_goal,
         stand_pct = stand/stand_goal,
         move_bool = if_else(move_pct &lt; 1, FALSE, TRUE),
         exercise_bool = if_else(exercise_pct &lt; 1, FALSE, TRUE),
         stand_bool = if_else(stand_pct &lt; 1, FALSE, TRUE))</code></pre>
<p>I’ll <code>gather</code> my data 3 times for each metric (and <strong>won’t</strong> write a function, go tell <span class="citation" data-cites="drob">@drob</span> on me), and stitch it together to get a tall dataset.</p>
<pre class="r"><code>
df_activity_tall_value &lt;- df_activity_tidy %&gt;% 
  select(date, Move = move, Exercise = exercise, Stand = stand) %&gt;% 
  gather(category, value, -date)

df_activity_tall_pct &lt;- df_activity_tidy %&gt;% 
  select(date, Move = move_pct, Exercise = exercise_pct, Stand = stand_pct) %&gt;% 
  gather(category, pct, -date)

df_activity_tall_bool &lt;- df_activity_tidy %&gt;% 
  select(date, Move = move_bool, Exercise = exercise_bool, Stand = stand_bool) %&gt;% 
  gather(category, boolean, -date)
  
df_activity_tall &lt;- df_activity_tall_value %&gt;% 
  left_join(df_activity_tall_pct, by = c(&quot;date&quot;, &quot;category&quot;)) %&gt;% 
  left_join(df_activity_tall_bool, by = c(&quot;date&quot;, &quot;category&quot;)) %&gt;% 
  mutate(category = as_factor(category, levels = c(&quot;Move&quot;, &quot;Exercise&quot;, &quot;Stand&quot;)),
         month = ymd(paste(year(date), month(date), 1, sep = &quot;-&quot;)),
         week = date - wday(date) + 1,
         wday = wday(date),
         day = day(date))</code></pre>
<p>Now, I can visualize this in many different ways. I like the boolean metric, and so I’ll use that:</p>
<pre class="r"><code>
df_activity_tall %&gt;% 
  ggplot(aes(x = wday, y = week, fill = boolean)) +
    geom_tile(col = &quot;grey30&quot;, na.rm = FALSE) +
    theme(panel.grid.major = element_blank()) +
    scale_fill_manual(values = c(&quot;grey80&quot;, &quot;#1a9641&quot;)) +
    facet_wrap(~ category) +
    coord_fixed(ratio = 0.15) +
    guides(fill=FALSE) +
    labs(title = &quot;Apple Watch goals completion&quot;,
         caption = &#39;@taraskaduk | taraskaduk.com&#39;) +
    theme(axis.text.x = element_blank())</code></pre>
<p><img src="applewatch2.png" /></p>
<p>Or, I could match color to activity, but then I’d need to remove all <code>FALSE</code> values:</p>
<pre class="r"><code>
df_activity_tall %&gt;% 
  filter(boolean == TRUE) %&gt;% 
  ggplot(aes(x = wday, y = week, fill = category)) +
    geom_tile(col = &quot;grey50&quot;, na.rm = FALSE) +
    theme(panel.grid.major = element_blank()) +
    facet_wrap(~ category) +
    coord_fixed(ratio = 0.15) +
    guides(fill=FALSE) +
    labs(title = &quot;Apple Watch goals completion&quot;,
         caption = &#39;@taraskaduk | taraskaduk.com&#39;) +
    theme(axis.text.x = element_blank())</code></pre>
<p><img src="applewatch1.png" /></p>
<p>You can even do yourself a “Don’t Break The Chain” tracker, adding data from other tables and other sources:</p>
<p><img src="chain.png" /></p>
<p>And since we’re on the subject, you can do something like a streak count chart, seeing how long of a streak you can get:</p>
<pre class="r"><code>
df_activity_streak &lt;- df_activity_tall_bool %&gt;% 
  mutate(category = as_factor(category, levels = c(&quot;Move&quot;, &quot;Exercise&quot;, &quot;Stand&quot;))) %&gt;% 
  arrange(category, date) %&gt;% 
  group_by(category, 
           x = cumsum(c(TRUE, diff(boolean) %in% c(-1))),
           y = cumsum(c(TRUE, diff(boolean) %in% c(-1,1)))) %&gt;% 
  mutate(streak = if_else(boolean == FALSE, 0L, row_number())) %&gt;% 
  ungroup() 


ggplot(df_activity_streak, aes(x = date, y = streak, group = x, col = category)) +
  geom_line() +
  facet_grid(category~.) +
  guides(fill=FALSE) +
  labs(title = &quot;Streak Count&quot;,
       caption = &#39;@taraskaduk | taraskaduk.com&#39;)</code></pre>
<p><img src="streak.png" /></p>
<h2 id="final-thoughts">Final Thoughts</h2>
<p>If you’re a health nut and an Mac-head like me and happen have an iPhone and an Apple Watch ⌚️ - chances are there is a lot of data sitting in your Health app. Whether you want to just play with it (as much as I hate this colloquialism - it is sometimes unavoidable), or use it with some purpose - it is really easy to dig into it. Hope this post will help you get statred, as well as provide some ideas for your own purposes. Feel free to share your charts, but don’t forget to hide sensitive data (erasing a y-axis is a start)!</p>
<!--radix_placeholder_article_footer-->
<!--/radix_placeholder_article_footer-->
</div>

<div class="d-appendix">
</div>


<!--radix_placeholder_site_after_body-->
<!--/radix_placeholder_site_after_body-->
<!--radix_placeholder_appendices-->
<div class="appendix-bottom">
  <h3 id="citation">Citation</h3>
  <p>For attribution, please cite this work as</p>
  <pre class="citation-appendix short">Kaduk (2019, March 23). Edward Hillenaar: Analyze and visualize your iPhone's Health app data in R. Retrieved from https://taraskaduk.com/posts/2019-03-23-apple-health/</pre>
  <p>BibTeX citation</p>
  <pre class="citation-appendix long">@misc{kaduk2019analyze,
  author = {Kaduk, Taras},
  title = {Edward Hillenaar: Analyze and visualize your iPhone's Health app data in R},
  url = {https://taraskaduk.com/posts/2019-03-23-apple-health/},
  year = {2019}
}</pre>
</div>
<!--/radix_placeholder_appendices-->
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN" "http://www.w3.org/TR/REC-html40/loose.dtd">
<!--radix_placeholder_navigation_after_body--><html><body>
<div class="distill-site-nav distill-site-footer">
<p>© Copyright 2017 Taras Kaduk.</p>
<p>Website template is by <a href="https://distill.pub/about/">Distill.pub</a> and <a href="https://www.rstudio.com">RStudio, Inc</a>.</p>
<p>Original text and figures are licensed under <a href="https://creativecommons.org/licenses/by-nc/4.0/">Creative Commons
Attribution-NonCommercial CC BY-NC 4.0</a>.</p>
</div>
<!--/radix_placeholder_navigation_after_body-->
</body></html>


</body>

</html>
